import{d as n,r as e,b as a,e as t,f as o,j as c,F as r,g as d,t as s,_ as i}from"./index-C1Ndtg44.js";import"./phaser-BvzNzgtf.js";const p={class:"note-detail"},l={class:"note-header"},v={class:"note-tags"},h=i(n({__name:"WebServiceConfigView",setup(n){const i=e(["Nginx","Web服務","後端","反向代理"]);return(n,e)=>(t(),a("div",p,[o("div",l,[e[0]||(e[0]=o("h1",null,"網站服務配置",-1)),o("div",v,[(t(!0),a(r,null,d(i.value,(n=>(t(),a("span",{class:"tag",key:n},s(n),1)))),128))]),e[1]||(e[1]=o("div",{class:"note-meta"},[o("span",{class:"date"},"更新日期: 2025-11-24")],-1))]),e[2]||(e[2]=c('<div class="note-content" data-v-3c291366><section data-v-3c291366><h2 data-v-3c291366>1. Nginx 安裝與基礎配置</h2><p data-v-3c291366>Nginx 是一個高性能的 HTTP 和反向代理伺服器，也是一個 IMAP/POP3/SMTP 代理伺服器：</p><h3 data-v-3c291366>1.1 安裝 Nginx</h3><pre data-v-3c291366><code data-v-3c291366>\n# 更新套件庫\n$ sudo apt update\n\n# 安裝 Nginx\n$ sudo apt install nginx\n\n# 檢查 Nginx 版本\n$ nginx -v\n        </code></pre><h3 data-v-3c291366>1.2 管理 Nginx 服務</h3><pre data-v-3c291366><code data-v-3c291366>\n# 啟動 Nginx 服務\n$ sudo systemctl start nginx\n\n# 停止 Nginx 服務\n$ sudo systemctl stop nginx\n\n# 重啟 Nginx 服務\n$ sudo systemctl restart nginx\n\n# 重新載入配置（不中斷服務）\n$ sudo systemctl reload nginx\n\n# 檢查 Nginx 服務狀態\n$ sudo systemctl status nginx\n\n# 設置開機自啟\n$ sudo systemctl enable nginx\n        </code></pre><h3 data-v-3c291366>1.3 Nginx 目錄結構</h3><p data-v-3c291366>了解 Nginx 的目錄結構有助於更好地管理配置：</p><ul data-v-3c291366><li data-v-3c291366><strong data-v-3c291366>/etc/nginx/</strong>：Nginx 主配置目錄</li><li data-v-3c291366><strong data-v-3c291366>/etc/nginx/nginx.conf</strong>：主配置文件</li><li data-v-3c291366><strong data-v-3c291366>/etc/nginx/sites-available/</strong>：可用站點配置</li><li data-v-3c291366><strong data-v-3c291366>/etc/nginx/sites-enabled/</strong>：已啟用站點配置（通常是符號連結）</li><li data-v-3c291366><strong data-v-3c291366>/var/log/nginx/</strong>：日誌文件目錄</li><li data-v-3c291366><strong data-v-3c291366>/var/www/html/</strong>：默認網站根目錄</li></ul></section><section data-v-3c291366><h2 data-v-3c291366>2. 靜態網站配置</h2><p data-v-3c291366>配置 Nginx 來託管靜態網站：</p><h3 data-v-3c291366>2.1 創建網站目錄</h3><pre data-v-3c291366><code data-v-3c291366>\n# 創建網站目錄\n$ sudo mkdir -p /var/www/yourdomain.com/html\n\n# 設置適當的權限\n$ sudo chown -R $USER:$USER /var/www/yourdomain.com/html\n$ sudo chmod -R 755 /var/www/yourdomain.com\n        </code></pre><h3 data-v-3c291366>2.2 創建測試頁面</h3><pre data-v-3c291366><code data-v-3c291366>\n# 創建簡單的 HTML 頁面\n$ sudo nano /var/www/yourdomain.com/html/index.html\n\n# HTML 內容範例\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Welcome to yourdomain.com!&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;Success! Your Nginx server is working!&lt;/h1&gt;\n    &lt;p&gt;This is a test page for yourdomain.com.&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n        </code></pre><h3 data-v-3c291366>2.3 創建伺服器塊配置</h3><pre data-v-3c291366><code data-v-3c291366>\n# 創建站點配置文件\n$ sudo nano /etc/nginx/sites-available/yourdomain.com\n\n# 配置內容範例（靜態網站）\nserver {\n    listen 80;\n    listen [::]:80;\n    \n    root /var/www/yourdomain.com/html;\n    index index.html index.htm index.nginx-debian.html;\n    \n    server_name yourdomain.com www.yourdomain.com;\n    \n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n        </code></pre><h3 data-v-3c291366>2.4 啟用站點配置</h3><pre data-v-3c291366><code data-v-3c291366>\n# 創建符號連結到 sites-enabled 目錄\n$ sudo ln -s /etc/nginx/sites-available/yourdomain.com /etc/nginx/sites-enabled/\n\n# 測試配置是否有語法錯誤\n$ sudo nginx -t\n\n# 重新載入 Nginx 配置\n$ sudo systemctl reload nginx\n        </code></pre></section><section data-v-3c291366><h2 data-v-3c291366>3. 後端反向代理配置</h2><p data-v-3c291366>使用 Nginx 作為反向代理，將請求轉發到後端應用服務：</p><h3 data-v-3c291366>3.1 基本反向代理配置</h3><pre data-v-3c291366><code data-v-3c291366>\n# 編輯站點配置文件\n$ sudo nano /etc/nginx/sites-available/yourdomain.com\n\n# 配置內容範例（反向代理）\nserver {\n    listen 80;\n    server_name yourdomain.com www.yourdomain.com;\n    \n    location / {\n        proxy_pass http://127.0.0.1:5000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n        </code></pre><h3 data-v-3c291366>3.2 代理參數說明</h3><ul data-v-3c291366><li data-v-3c291366><strong data-v-3c291366>proxy_pass</strong>：指定後端服務的地址</li><li data-v-3c291366><strong data-v-3c291366>proxy_set_header Host</strong>：設置請求頭中的 Host 字段</li><li data-v-3c291366><strong data-v-3c291366>proxy_set_header X-Real-IP</strong>：傳遞客戶端真實 IP</li><li data-v-3c291366><strong data-v-3c291366>proxy_set_header X-Forwarded-For</strong>：傳遞代理鏈信息</li><li data-v-3c291366><strong data-v-3c291366>proxy_set_header X-Forwarded-Proto</strong>：傳遞原始協議（http 或 https）</li></ul><h3 data-v-3c291366>3.3 WebSocket 代理配置</h3><pre data-v-3c291366><code data-v-3c291366>\n# WebSocket 代理配置範例\nlocation /socket.io/ {\n    proxy_pass http://127.0.0.1:5000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection &quot;upgrade&quot;;\n    proxy_set_header Host $host;\n    proxy_cache_bypass $http_upgrade;\n}\n        </code></pre><h3 data-v-3c291366>3.4 上傳文件大小限制</h3><pre data-v-3c291366><code data-v-3c291366>\n# 增加上傳文件大小限制\nclient_max_body_size 100M;\n\n# 可以在 http, server 或 location 塊中設置\n        </code></pre></section><section data-v-3c291366><h2 data-v-3c291366>4. 虛擬主機設置</h2><p data-v-3c291366>在同一台伺服器上託管多個網站：</p><h3 data-v-3c291366>4.1 基於域名的虛擬主機</h3><pre data-v-3c291366><code data-v-3c291366>\n# 第一個網站配置\nserver {\n    listen 80;\n    server_name site1.com www.site1.com;\n    root /var/www/site1.com/html;\n    \n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n\n# 第二個網站配置\nserver {\n    listen 80;\n    server_name site2.com www.site2.com;\n    root /var/www/site2.com/html;\n    \n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n        </code></pre><h3 data-v-3c291366>4.2 基於端口的虛擬主機</h3><pre data-v-3c291366><code data-v-3c291366>\n# 在 80 端口的網站\nserver {\n    listen 80;\n    server_name yourdomain.com;\n    root /var/www/site1;\n    \n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n\n# 在 8080 端口的網站\nserver {\n    listen 8080;\n    server_name yourdomain.com;\n    root /var/www/site2;\n    \n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n        </code></pre><h3 data-v-3c291366>4.3 默認伺服器</h3><pre data-v-3c291366><code data-v-3c291366>\n# 設置默認伺服器\nserver {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n    \n    server_name _;\n    root /var/www/default;\n    \n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n        </code></pre></section><section data-v-3c291366><h2 data-v-3c291366>5. SSL/TLS 配置</h2><p data-v-3c291366>使用 Let&#39;s Encrypt 配置 HTTPS：</p><h3 data-v-3c291366>5.1 安裝 Certbot</h3><pre data-v-3c291366><code data-v-3c291366>\n# 安裝 Certbot\n$ sudo apt install certbot python3-certbot-nginx\n        </code></pre><h3 data-v-3c291366>5.2 獲取 SSL 證書</h3><pre data-v-3c291366><code data-v-3c291366>\n# 自動配置 Nginx 和獲取證書\n$ sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com\n\n# 只獲取證書，不修改 Nginx 配置\n$ sudo certbot certonly --nginx -d yourdomain.com -d www.yourdomain.com\n        </code></pre><h3 data-v-3c291366>5.3 手動 SSL 配置</h3><pre data-v-3c291366><code data-v-3c291366>\n# SSL 配置範例\nserver {\n    listen 443 ssl;\n    server_name yourdomain.com www.yourdomain.com;\n    \n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n    \n    # SSL 參數優化\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers on;\n    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n    ssl_session_timeout 1d;\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_tickets off;\n    \n    # HSTS 設置\n    add_header Strict-Transport-Security &quot;max-age=63072000&quot; always;\n    \n    root /var/www/yourdomain.com/html;\n    index index.html index.htm;\n    \n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n        </code></pre><h3 data-v-3c291366>5.4 HTTP 重定向到 HTTPS</h3><pre data-v-3c291366><code data-v-3c291366>\n# 將 HTTP 重定向到 HTTPS\nserver {\n    listen 80;\n    server_name yourdomain.com www.yourdomain.com;\n    \n    location / {\n        return 301 https://$host$request_uri;\n    }\n}\n        </code></pre><h3 data-v-3c291366>5.5 自動續期證書</h3><pre data-v-3c291366><code data-v-3c291366>\n# 測試自動續期\n$ sudo certbot renew --dry-run\n\n# 自動續期已經由 Certbot 設置了 cron 任務\n# 可以查看：\n$ sudo systemctl list-timers\n        </code></pre></section><section data-v-3c291366><h2 data-v-3c291366>6. 負載均衡配置</h2><p data-v-3c291366>使用 Nginx 實現負載均衡：</p><h3 data-v-3c291366>6.1 定義上游服務器組</h3><pre data-v-3c291366><code data-v-3c291366>\n# 在 http 區塊中定義上游服務器組\nupstream backend {\n    server 127.0.0.1:8001;\n    server 127.0.0.1:8002;\n    server 127.0.0.1:8003;\n}\n        </code></pre><h3 data-v-3c291366>6.2 負載均衡方法</h3><pre data-v-3c291366><code data-v-3c291366>\n# 輪詢（默認）\nupstream backend {\n    server 127.0.0.1:8001;\n    server 127.0.0.1:8002;\n}\n\n# 最少連接\nupstream backend {\n    least_conn;\n    server 127.0.0.1:8001;\n    server 127.0.0.1:8002;\n}\n\n# IP 哈希\nupstream backend {\n    ip_hash;\n    server 127.0.0.1:8001;\n    server 127.0.0.1:8002;\n}\n\n# 加權輪詢\nupstream backend {\n    server 127.0.0.1:8001 weight=3;\n    server 127.0.0.1:8002 weight=1;\n}\n        </code></pre><h3 data-v-3c291366>6.3 使用上游服務器組</h3><pre data-v-3c291366><code data-v-3c291366>\nserver {\n    listen 80;\n    server_name yourdomain.com;\n    \n    location / {\n        proxy_pass http://backend;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n        </code></pre><h3 data-v-3c291366>6.4 服務器健康檢查</h3><pre data-v-3c291366><code data-v-3c291366>\n# 使用 Nginx Plus 的健康檢查（商業版）\nupstream backend {\n    zone backend 64k;\n    server 127.0.0.1:8001 max_fails=3 fail_timeout=30s;\n    server 127.0.0.1:8002 max_fails=3 fail_timeout=30s;\n}\n\n# 開源版本的簡單失敗處理\nupstream backend {\n    server 127.0.0.1:8001 max_fails=3 fail_timeout=30s;\n    server 127.0.0.1:8002 max_fails=3 fail_timeout=30s;\n    server 127.0.0.1:8003 backup;  # 備用服務器\n}\n        </code></pre></section><section data-v-3c291366><h2 data-v-3c291366>7. 快取配置</h2><p data-v-3c291366>配置 Nginx 快取以提高性能：</p><h3 data-v-3c291366>7.1 靜態文件快取</h3><pre data-v-3c291366><code data-v-3c291366>\n# 在 http 區塊中設置快取路徑\nhttp {\n    # ...其他配置...\n    \n    # 瀏覽器快取控制\n    location ~* \\.(jpg|jpeg|png|gif|ico|css|js)$ {\n        expires 30d;\n        add_header Cache-Control &quot;public, no-transform&quot;;\n    }\n}\n        </code></pre><h3 data-v-3c291366>7.2 代理快取</h3><pre data-v-3c291366><code data-v-3c291366>\n# 設置代理快取\nhttp {\n    # ...其他配置...\n    \n    # 定義快取路徑和參數\n    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=1g inactive=60m;\n    \n    server {\n        # ...其他配置...\n        \n        location / {\n            proxy_pass http://backend;\n            proxy_cache my_cache;\n            proxy_cache_valid 200 302 10m;\n            proxy_cache_valid 404 1m;\n            proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;\n            proxy_cache_lock on;\n            add_header X-Cache-Status $upstream_cache_status;\n        }\n    }\n}\n        </code></pre><h3 data-v-3c291366>7.3 微快取</h3><pre data-v-3c291366><code data-v-3c291366>\n# 微快取配置\nhttp {\n    # ...其他配置...\n    \n    # 定義微快取\n    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=microcache:10m max_size=1g inactive=60m;\n    \n    server {\n        # ...其他配置...\n        \n        location / {\n            proxy_pass http://backend;\n            proxy_cache microcache;\n            proxy_cache_valid 200 302 1s;\n            proxy_cache_use_stale updating;\n            proxy_cache_lock on;\n            add_header X-Cache-Status $upstream_cache_status;\n        }\n    }\n}\n        </code></pre><h3 data-v-3c291366>7.4 快取清除</h3><pre data-v-3c291366><code data-v-3c291366>\n# 手動清除快取\n$ sudo rm -rf /var/cache/nginx/*\n\n# 使用 Nginx Plus 的快取清除 API（商業版）\nlocation /purge {\n    allow 127.0.0.1;\n    deny all;\n    proxy_cache_purge my_cache $host$request_uri;\n}\n        </code></pre></section><section data-v-3c291366><h2 data-v-3c291366>8. 性能優化</h2><p data-v-3c291366>優化 Nginx 配置以提高性能：</p><h3 data-v-3c291366>8.1 工作進程與連接</h3><pre data-v-3c291366><code data-v-3c291366>\n# 在 nginx.conf 中調整工作進程數\nworker_processes auto;  # 自動設置為 CPU 核心數\n# 或手動設置\n# worker_processes 4;\n\n# 調整每個工作進程的連接數\nevents {\n    worker_connections 1024;\n    multi_accept on;\n    use epoll;  # Linux 系統推薦\n}\n        </code></pre><h3 data-v-3c291366>8.2 緩衝區優化</h3><pre data-v-3c291366><code data-v-3c291366>\n# 調整緩衝區大小\nhttp {\n    # ...其他配置...\n    \n    client_body_buffer_size 10K;\n    client_header_buffer_size 1k;\n    client_max_body_size 8m;\n    large_client_header_buffers 4 4k;\n    \n    client_body_timeout 12;\n    client_header_timeout 12;\n    keepalive_timeout 15;\n    send_timeout 10;\n}\n        </code></pre><h3 data-v-3c291366>8.3 壓縮配置</h3><pre data-v-3c291366><code data-v-3c291366>\n# 啟用 Gzip 壓縮\nhttp {\n    # ...其他配置...\n    \n    gzip on;\n    gzip_comp_level 5;\n    gzip_min_length 256;\n    gzip_proxied any;\n    gzip_vary on;\n    gzip_types\n        application/atom+xml\n        application/javascript\n        application/json\n        application/ld+json\n        application/manifest+json\n        application/rss+xml\n        application/vnd.geo+json\n        application/vnd.ms-fontobject\n        application/x-font-ttf\n        application/x-web-app-manifest+json\n        application/xhtml+xml\n        application/xml\n        font/opentype\n        image/bmp\n        image/svg+xml\n        image/x-icon\n        text/cache-manifest\n        text/css\n        text/plain\n        text/vcard\n        text/vnd.rim.location.xloc\n        text/vtt\n        text/x-component\n        text/x-cross-domain-policy;\n}\n        </code></pre><h3 data-v-3c291366>8.4 開啟文件快取</h3><pre data-v-3c291366><code data-v-3c291366>\n# 開啟文件快取\nhttp {\n    # ...其他配置...\n    \n    open_file_cache max=1000 inactive=20s;\n    open_file_cache_valid 30s;\n    open_file_cache_min_uses 2;\n    open_file_cache_errors on;\n}\n        </code></pre></section><section data-v-3c291366><h2 data-v-3c291366>9. 安全設置</h2><p data-v-3c291366>加強 Nginx 的安全性：</p><h3 data-v-3c291366>9.1 隱藏版本信息</h3><pre data-v-3c291366><code data-v-3c291366>\n# 在 http 區塊中隱藏版本信息\nhttp {\n    # ...其他配置...\n    \n    server_tokens off;\n}\n        </code></pre><h3 data-v-3c291366>9.2 添加安全頭信息</h3><pre data-v-3c291366><code data-v-3c291366>\n# 添加安全相關的 HTTP 頭\nserver {\n    # ...其他配置...\n    \n    add_header X-Frame-Options &quot;SAMEORIGIN&quot; always;\n    add_header X-XSS-Protection &quot;1; mode=block&quot; always;\n    add_header X-Content-Type-Options &quot;nosniff&quot; always;\n    add_header Referrer-Policy &quot;no-referrer-when-downgrade&quot; always;\n    add_header Content-Security-Policy &quot;default-src &#39;self&#39; http: https: data: blob: &#39;unsafe-inline&#39;&quot; always;\n    add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains; preload&quot; always;\n}\n        </code></pre><h3 data-v-3c291366>9.3 限制請求</h3><pre data-v-3c291366><code data-v-3c291366>\n# 限制請求速率\nhttp {\n    # ...其他配置...\n    \n    # 定義限制區域\n    limit_req_zone $binary_remote_addr zone=mylimit:10m rate=10r/s;\n    \n    server {\n        # ...其他配置...\n        \n        # 應用限制\n        location /login {\n            limit_req zone=mylimit burst=20 nodelay;\n            # ...其他配置...\n        }\n    }\n}\n        </code></pre><h3 data-v-3c291366>9.4 基本身份認證</h3><pre data-v-3c291366><code data-v-3c291366>\n# 創建密碼文件\n$ sudo apt install apache2-utils\n$ sudo htpasswd -c /etc/nginx/.htpasswd username\n\n# 配置基本認證\nlocation /admin {\n    auth_basic &quot;Restricted Access&quot;;\n    auth_basic_user_file /etc/nginx/.htpasswd;\n    # ...其他配置...\n}\n        </code></pre></section><section data-v-3c291366><h2 data-v-3c291366>10. 監控與日誌</h2><p data-v-3c291366>配置 Nginx 日誌和監控：</p><h3 data-v-3c291366>10.1 訪問日誌格式</h3><pre data-v-3c291366><code data-v-3c291366>\n# 自定義日誌格式\nhttp {\n    # ...其他配置...\n    \n    log_format main &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;\n                    &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;\n                    &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;\n    \n    access_log /var/log/nginx/access.log main;\n    error_log /var/log/nginx/error.log warn;\n}\n        </code></pre><h3 data-v-3c291366>10.2 按域名分割日誌</h3><pre data-v-3c291366><code data-v-3c291366>\n# 為每個域名設置獨立的日誌\nserver {\n    server_name example.com;\n    access_log /var/log/nginx/example.com.access.log;\n    error_log /var/log/nginx/example.com.error.log;\n    # ...其他配置...\n}\n        </code></pre><h3 data-v-3c291366>10.3 日誌輪替</h3><pre data-v-3c291366><code data-v-3c291366>\n# 配置 logrotate\n$ sudo nano /etc/logrotate.d/nginx\n\n# 配置內容範例\n/var/log/nginx/*.log {\n    daily\n    missingok\n    rotate 14\n    compress\n    delaycompress\n    notifempty\n    create 0640 www-data adm\n    sharedscripts\n    postrotate\n        if [ -f /var/run/nginx.pid ]; then\n            kill -USR1 `cat /var/run/nginx.pid`\n        fi\n    endscript\n}\n        </code></pre><h3 data-v-3c291366>10.4 狀態監控</h3><pre data-v-3c291366><code data-v-3c291366>\n# 啟用 Nginx 狀態頁面\nhttp {\n    # ...其他配置...\n    \n    server {\n        # ...其他配置...\n        \n        location /nginx_status {\n            stub_status on;\n            allow 127.0.0.1;\n            deny all;\n        }\n    }\n}\n        </code></pre></section></div>',1))]))}}),[["__scopeId","data-v-3c291366"]]);export{h as default};
